"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f51550c7-2f8f-5d32-af21-64e960a684ba")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([["3925"],{778254(e,t,r){r.d(t,{e:()=>s});let s="https://go/figmascope-docs"},375143(e,t,r){r.d(t,{rf:()=>i,tV:()=>l,zG:()=>a});var s=r(239976),n=r(660983);function a(){return(0,s.jsx)(l,{children:(0,s.jsx)("p",{children:"Reading file..."})})}function i({error:e}){let t="Oops! Something went wrong";return"string"==typeof e?t=e:e instanceof Error&&(t=e.message,console.error(e)),(0,s.jsx)(l,{children:(0,s.jsx)("p",{style:n.sx.colorTextOndanger.colorBgDanger.p16.font20.maxW400.$,children:t})})}function l({children:e}){return(0,s.jsx)("div",{style:n.sx.fillPositionedContainer.flex.itemsCenter.justifyCenter.flexColumn.lh1_5Lines.font16.$,children:e})}},421118(e,t,r){let s;r.d(t,{J:()=>tm});var n=r(239976),a=r(105652),i=r(335294),l=r(350923),o=r(181645),d=r(886101),c=r(490753),u=r(528984),h=r(660983),f=r(796e3),p=r(304499),g=r(372996),m=r(116682),x=r(206324),b=r(842602),v=r(961693);let j=(0,l.eU)(e=>{let t=e(x.OC);return"fullscreen"===t.view?`/api/file/scenegraph_validations/${t.fileKey}`:(0,b.E)(t)&&t.urlParams?.type==="server_file"?`/api/admin/scenegraph_validations/${t.urlParams.key}`:null}),k=(0,l.eU)(e=>null!=e(j)),y=(s=(0,l.eU)((0,g.Ok)()),(0,l.eU)(e=>e(s),async(e,t)=>{let r;if(e(s).status===u.r.LOADING)return;let n=e(j);if(n){t(s,(0,g.ux)());try{r=await C(n)}catch(e){t(s,(0,g.uW)(e));return}t(s,(0,g.NY)(r))}}));async function C(e){let t=await (0,m.GD)(e),r=new v._;for(let e of t.data.meta.data.results.violations)if("always-fail-for-testing"!==e.name)for(let t of e.instances)r.add(t.guid,t.message);return r}var w=r(55511),S=r(466798),I=r(375143),_=r(174822),T=r(980973),N=r(594293),E=r(688357),M=r(901326),A=r(163423),F=r.n(A),L=r(289886),P=r(397383),z=r(454036);let D=(0,S.Sv)("bookmarkSettings",{bookmarks:{}}),O=(0,l.eU)(e=>{let t=e(D),r=e(p.Cc).id;return new Set((t.bookmarks[r]??[]).map(e=>e.id))});function $(){let[e,t]=(0,l.fp)(D),r=(0,l.md)(p.Cc).id,s=a.useCallback(s=>{t({...e,bookmarks:{...e.bookmarks,[r]:s(e.bookmarks[r]||[])}})},[e,r,t]),n=a.useCallback((e,t)=>{s(r=>[...r,{id:e,name:t}])},[s]),i=a.useCallback(e=>{s(t=>t.filter((t,r)=>r!==e))},[s]),o=a.useCallback((e,t)=>{s(r=>r.map((r,s)=>s===e?{...r,name:t}:r))},[s]),d=a.useCallback((e,t)=>{s(r=>r.map((r,s)=>s===e?{...r,id:z.SW.fromString(t)}:r))},[s]),c=a.useCallback(e=>{s(t=>{if(e>=t.length-1)return t;let r=t.slice(),[s]=r.splice(e,1);return r.splice(e+1,0,s),r})},[s]);return{addBookmark:n,deleteBookmark:i,moveBookmarkDown:c,moveBookmarkUp:a.useCallback(e=>{s(t=>{if(e<=0)return t;let r=t.slice(),[s]=r.splice(e,1);return r.splice(e-1,0,s),r})},[s]),renameBookmark:o,updateBookmarkId:d,bookmarks:a.useMemo(()=>e.bookmarks[r]||[],[e,r])}}var R=r(14796);function U(e,t,r){return[...e.getObject(r)?.mapDescendants(e=>e.id)??[],...t?.getObject(r)?.mapDescendants(e=>e.id)??[]]}let H=(0,l.FZ)((0,l.eU)({}),(e,t,r)=>{let s=r(p.Cc),n=r(p.lX);switch(t.type){case"toggleExpanded":return(0,R.X9)(e,t.objectId,t.toggleSubtree?U(s,n,t.objectId):[]);case"expandAncestors":var a;return(0,R.nE)(e,(a=t.objectId,[...s.getObject(a)?.mapAncestors(e=>e.id)??[],...n?.getObject(a)?.mapAncestors(e=>e.id)??[]]),!0);case"expandDescendants":return(0,R.nE)(e,[t.objectId,...U(s,n,t.objectId)],!0);case"collapseDescendants":return(0,R.IO)(e,[t.objectId,...U(s,n,t.objectId)])}});var B=r(130729),V=r(745463),G=r(885374);let K=(0,l.eU)({status:"initial"}),X=(0,l.eU)(0),Y=(0,l.eU)(!1),q=(0,l.eU)(e=>{if(e(Y)){let t=e(X);return`Indexing search results (this may take a moment)... [${t}/???]`}return null}),W=(0,S.Sv)("searchMode",S.Y6.Search),J=(0,l.eU)(e=>{let t=e(K),r=e(p.Cc),s=e(w.Sd);return"initial"===t.status?s.map(e=>r.getObject(e)).filter(V.Vq).map(e=>({object:e,matches:[]})).reverse():"results"in t&&t.results.length>0?t.results:null}),Q=(0,l.eU)(e=>{let t=e(K);if("searching"===t.status&&0===t.results.length){let t=["Searching..."],r=e(q);return r&&t.push(r),t}if("success"===t.status&&0===t.results.length){let t=["No results found."],r=e(p.Cc);return r instanceof G.G2&&t.push("Some content may be unavailable because of incremental loading"),"hide"===r.sensitiveTextPolicy&&t.push("Searching text fields is limited beacuse text redaction has been applied."),t}return"error"===t.status?["Error searching:",String(t.error)]:null}),Z=(0,l.eU)(e=>{if(e(W)!==S.Y6.Filter)return null;let t=e(K);return"results"in t?t.results.map(e=>e.object):null}),ee=(0,l.eU)(e=>{if(e(W)!==S.Y6.Filter)return null;let t=e(Q);return t?t.join(" "):null}),et=(0,S.Sv)("sortOrder",S.hX.Position),er=(0,l.eU)(e=>{let t=[S.hX.Position,S.hX.Name,S.hX.NodeId];return e(p.Cc).rootObjects[0]?.displayProperties.memoryFraction!=null&&t.push(S.hX.Memory),t.sort(),t}),es=(0,l.eU)(e=>{switch(e(et)){case S.hX.Position:return ea;case S.hX.Name:return en;case S.hX.Memory:return el;case S.hX.NodeId:return ei}});function en(e,t){return e.displayProperties.name.localeCompare(t.displayProperties.name)}function ea(e,t){let[r,s]=eo(e,t);if(r&&s){let e=r.parentIndex?.position,t=s.parentIndex?.position;if(null==e&&null==t)return 0;if(null==t)return 1;if(null==e)return -1;else if(e<t)return -1;else if(e>t)return 1}return en(e,t)}function ei(e,t){let[r,s]=eo(e,t);if(r&&s){let{sessionID:e,localID:t}=r.guid??{localID:-1,sessionID:-1},{sessionID:n,localID:a}=s.guid??{localID:-1,sessionID:-1};return e-n||t-a}return ea(e,t)}function el(e,t){return(t.displayProperties.memoryFraction??0)-(e.displayProperties.memoryFraction??0)||ea(e,t)}function eo(e,t){return"nodeChange"in e&&"nodeChange"in t?[e.nodeChange,t.nodeChange]:[null,null]}var ed=r(901190),ec=r(596994),eu=r(850159),eh=r(791041),ef=r(645724),ep=r(922023),eg=r(7800);let em=ef.ms,ex=ef.c$,eb=ef.wv;function ev({contextMenuData:{objectId:e,position:t},onClose:r}){let[s,i]=a.useState(0),o=t.left,d=t.top+s>window.innerHeight?t.top-s:t.top,{canSelectInApp:c,selectInApp:u}=a.useContext(w.H$),g=a.useRef(null);(0,eh.ww)(g,r);let m=(0,l.md)(p.Cc).getObject(e),x=m instanceof eg.R?m:null,b=m instanceof ep.E?m:null,[v,j]=(0,l.fp)(f.Oz),k=(0,l.Xr)(H);if(null==m)return null;let y=e=>()=>{e(),r()},C=m.children.length>0,S=(()=>{if(c?.(m))return y(()=>u(m))})(),I=e=>y(()=>E.glU?.triggerAction(e,{guid:m.id})),_=v?.object.id===m.id;return(0,n.jsx)(em,{style:{...h.sx.fixed.$,left:o,top:d},dropdownRef:e=>{e&&i(e.clientHeight)},children:(0,n.jsxs)("div",{ref:g,children:[S&&(0,n.jsx)(ex,{onClick:S,children:"Jump to node"}),C&&(0,n.jsx)(ex,{onClick:y(()=>k({type:"expandDescendants",objectId:e})),children:"Expand descendants"}),C&&(0,n.jsx)(ex,{onClick:y(()=>k({type:"collapseDescendants",objectId:e})),children:"Collapse descendants"}),(S||C)&&(0,n.jsx)(eb,{}),_&&(0,n.jsx)(ex,{onClick:y(()=>j({type:"clear"})),children:"Stop diffing against this node"}),(!_||v?.type!==f.Lp.Layer)&&(0,n.jsx)(ex,{onClick:y(()=>j({type:"start",diffType:f.Lp.Layer,id:e})),children:"Layer diff against this node"}),(!_||v?.type!==f.Lp.Tree)&&(0,n.jsx)(ex,{onClick:y(()=>j({type:"start",diffType:f.Lp.Tree,id:e})),children:"Tree diff against this node"}),x&&(0,n.jsx)(eb,{}),x&&(0,n.jsx)(ex,{onClick:y(()=>{let e=JSON.stringify(x.nodeChange,null,2);navigator.clipboard.writeText(e)}),children:"Copy NodeChange JSON"}),b&&"DOCUMENT"!==b.type&&"CANVAS"!==b.type&&(0,n.jsx)(ex,{onClick:I("debug-print-as-test-code"),children:(0,eu.tx)("fullscreen_actions.debug-print-as-test-code")}),b&&"VECTOR"===b.type&&(0,n.jsx)(ex,{onClick:I("debug-print-vector-network-as-test-code"),children:(0,eu.tx)("fullscreen_actions.debug-print-vector-network-as-test-code")})]})})}var ej=r(122390);let ek=a.memo(function({diffType:e,id:t,primaryId:r,secondaryId:s,leftBadges:i,indent:l,index:o,isExpanded:d,isLeaf:c,isSelected:u,isSelectedSecondary:h,memoryFraction:f,rightBadges:p,name:g,style:m,select:x,toggle:b,showContextMenu:v}){let j=a.useCallback(e=>{e.preventDefault(),v({objectId:t,position:{left:e.clientX,top:e.clientY}})},[t,v]);return(0,n.jsxs)(ej.Z,{changeType:e,indent:l,isExpanded:d,isLeaf:c,isSelected:u,isSelectedSecondary:h,keyboardNavigationPath:[o],onContextMenu:j,onMouseEnter:()=>{E.Ez5&&E.Ez5.editorState().figmaScopeHighlightedNode.set(t)},onMouseLeave:()=>{E.Ez5&&E.Ez5.editorState().figmaScopeHighlightedNode.set("")},select:()=>x(t),style:m,toggleExpanded:e=>b(t,e),children:[(0,n.jsx)(ed.IV,{badges:i}),(0,n.jsx)(ec.nK,{id:r}),s&&(0,n.jsx)(ec.nK,{id:s,secondary:!0}),(0,n.jsx)("div",{title:g,className:L.s.ellipsis.noWrap.overflowHidden.$,children:g}),(0,n.jsx)(P.M,{}),(0,n.jsx)(ed.IV,{badges:p}),null!=f&&(0,n.jsxs)("span",{className:L.s.colorTextSecondary.$,title:"Node memory usage",children:[(100*f).toFixed(3),"%"]})]})});function ey({style:e,data:{displayedObjects:t,selectedId:r,selectedIds:s,...a},index:i}){let l=t[i],o=(0,M.zN)(e);return(0,n.jsx)(ek,{...l,...a,isSelected:r===l.id,isSelectedSecondary:!!l&&s.includes(l.id),style:o,index:i})}let eC=[];function ew({appSelection:e}){let t=(0,l.md)(eS),[r,s]=(0,l.fp)(w.AJ),i=(0,M.k9)(()=>e?.guids??eC,[e?.guids]),[o,d]=a.useState(null),c=a.useRef(null);a.useEffect(()=>{let e=t.findIndex(e=>e.id===r);e>=0&&c.current?.scrollToItem(e,"smart")},[t,r]);let u=(0,l.Xr)(H);a.useEffect(()=>{u({type:"expandAncestors",objectId:r})},[u,r]);let h=a.useCallback((e,t)=>{u({type:"toggleExpanded",objectId:e,toggleSubtree:t})},[u]),f=(0,l.md)(ee);return 0===t.length?(0,n.jsx)("div",{children:f??"Empty Scene"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(_.A,{disableWidth:!0,children:({height:e})=>(0,n.jsx)(T.Y1,{itemSize:18,itemCount:t.length,height:e,ref:c,itemData:{displayedObjects:t,selectedId:r,selectedIds:i,select:s,toggle:h,showContextMenu:d},width:"100%",children:ey})}),o&&(0,n.jsx)(ev,{contextMenuData:o,onClose:()=>{d(null)}})]})}let eS=(0,l.eU)(e=>{let t=e(O),r=e(p.Cc);return(e(eI)??e(e_)).map(e=>({...e,rightBadges:[...e.rightBadges,...t.has(e.id)?[{type:"bookmark",value:"Bookmarked"}]:[],...r.getAdditionalBadges?.(e.id)||[]]}))}),eI=(0,l.eU)(e=>{let t=e(Z);return t?t.map(e=>({...e.displayProperties,diffType:void 0,id:e.id,indent:0,isExpanded:!1,isLeaf:!0})):null}),e_=(0,l.eU)(e=>{let t=e(p.Cc).rootObjects,r=e(f.sg),s=e(H),n=e(es),a=(()=>{switch(r.type){case f.Lp.Tree:return[r.object];case f.Lp.Full:return r.resource.rootObjects;default:return[]}})(),i={sortFn:n,expandedIds:s};return F()(t,e=>{if(!e)return[];if(0===a.length)return eT(e,0,i);let t=eE(e,a);return t?eN(e,t,0,i):function e(t,r,s,n){let a=t.id,i=t.children,l=0===i.length,o=!!n.expandedIds[a],d=!1,c=F()(i,t=>{let a=(()=>{let a=eE(t,r);if(a)return eN(t,a,s+1,n);let i=r.filter(e=>e.someAncestor(e=>e.id===t.id,{includeSelf:!0}));return i.length>0?e(t,i,s+1,n):eT(t,s+1,n)})();return d=d||a[0]?.diffType!=null,a}),u={...t.displayProperties,diffType:d?"CHILD_MODIFIED":void 0,id:a,indent:s,isExpanded:o,isLeaf:l};return o?[u,...c]:[u]}(e,a,0,i)})});function eT(e,t,r){let s=e.id,n=e.children,a=0===n.length,i=!!r.expandedIds[s],l={...e.displayProperties,diffType:void 0,id:s,indent:t,isExpanded:i,isLeaf:a};return i?[l,...F()(eM(n,r.sortFn),e=>eT(e,t+1,r))]:[l]}function eN(e,t,r,s){let n=e??t;if(!n)throw Error("Diffing two nothings");if(e&&t&&e.id!==t.id)throw Error("Diffing nodes with mismatched keys");let a=n.id,i=eM(e?.children??[],s.sortFn),l=eM(t?.children??[],s.sortFn),o=(0,N.TR)(i,l,e=>e.id),d=!1,c=F()(o,({left:e,right:t})=>{let n=eN(e,t,r+1,s);return d=d||n[0]?.diffType!=null,n}),u=(0,f.wc)(e,t,d),h=e?.displayProperties.name,p=t?.displayProperties.name,g=null!=h&&null!=p&&h!==p?`${h} <=> ${p}`:n.displayProperties.name,m=!!s.expandedIds[a],x={...n.displayProperties,diffType:u,id:a,indent:r,isExpanded:m,isLeaf:0===o.length,name:g};return m?[x,...c]:[x]}function eE(e,t){return t.find(t=>t.id===e.id)}function eM(e,t){return e.slice().sort(t)}var eA=r(147911),eF=r(555235),eL=r(212055);r(574988);var eP=r(982538),ez=r(297151),eD=r(802254),eO=r(641272),e$=r(825993),eR=r(878438),eU=r(495747),eH=r(940188),eB=r(491220),eV=r(156829);function eG(e){let{bookmarks:t,deleteBookmark:r,moveBookmarkDown:s,moveBookmarkUp:i,renameBookmark:l,updateBookmarkId:o}=$();return(0,n.jsx)(eP.bL,{defaultPosition:{x:window.innerWidth/2,y:window.innerHeight/2},onClose:e.onClose,width:400,children:(0,n.jsxs)(ez.vo,{children:[(0,n.jsx)(ez.Y9,{children:(0,n.jsx)(ez.hE,{children:"FigmaScope Bookmarks"})}),(0,n.jsx)(ez.nB,{children:(0,n.jsxs)(eD.bL,{...{className:"xrvj5dj x1nfngrj"},children:[0===t.length&&(0,n.jsx)("div",{className:"x6s0dn4 x78zum5 xpyat2d xl56j7k",children:"No bookmarks"}),t.length>0&&(0,n.jsxs)(eO.fI,{...{className:"xrvj5dj xuhvigx xg2d0mh"},children:[(0,n.jsx)(e$.fh,{children:"Name"}),(0,n.jsx)(e$.fh,{children:"ID"})]}),t.map((e,d)=>(0,a.createElement)(eO.fI,{className:"xrvj5dj xuhvigx xg2d0mh",key:d},(0,n.jsx)(e$.fh,{children:(0,n.jsx)(eR.p,{id:`edit-bookmark-name-${d}`,value:e.name,onChange:e=>l(d,e)})}),(0,n.jsx)(e$.fh,{children:(0,n.jsx)(eR.p,{id:`edit-bookmark-id-${d}`,value:e.id,onChange:e=>o(d,e)})}),(0,n.jsx)(e$.fh,{children:(0,n.jsxs)(eU.e,{"aria-label":`Bookmark actions for ${e.name}`,children:[(0,n.jsx)(eF.K,{"aria-label":"Delete bookmark",onClick:()=>r(d),children:(0,n.jsx)(eH.i,{})}),(0,n.jsx)(eF.K,{"aria-label":"Move bookmark up",disabled:0===d,onClick:()=>i(d),children:(0,n.jsx)(eB.t,{})}),(0,n.jsx)(eF.K,{"aria-label":"Move bookmark down",disabled:d===t.length-1,onClick:()=>s(d),children:(0,n.jsx)(eV.O,{})})]})})))]})})]})})}function eK(){let[e,t]=(0,l.fp)(w.AJ),r=(0,l.md)(w.gg),{getTriggerProps:s,manager:i}=eA.b(),{addBookmark:o,bookmarks:d}=$(),[c,u]=a.useState(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(eA.bL,{manager:i,children:[(0,n.jsx)("div",{...{className:"xrybvsa"},children:(0,n.jsx)(eF.K,{...s(),"aria-label":"bookmarks",children:(0,n.jsx)(eL.j,{})})}),(0,n.jsxs)(eA.mc,{children:[(0,n.jsxs)(eA.YJ,{title:(0,n.jsx)(eA.r1,{children:"Bookmark settings"}),children:[(0,n.jsx)(eA.q7,{onClick:()=>{let t=r?.displayProperties.name??"Bookmark";o(e,`${t} - ${e}`)},children:"Add bookmark"}),(0,n.jsx)(eA.q7,{onClick:()=>{u(!0)},children:"Manage bookmarks"})]}),d.length?(0,n.jsx)(eA.YJ,{title:(0,n.jsx)(eA.r1,{children:"Bookmark list"}),children:d.map((e,r)=>(0,n.jsx)(eA.q7,{onClick:()=>{t(e.id)},children:e.name},r))}):null]})]}),c&&(0,n.jsx)(eG,{onClose:()=>u(!1)})]})}var eX=r(224542),eY=r.n(eX),eq=r(1102),eW=r(584376);function eJ({searchRef:e}){let t=(0,l.Xr)(w.AJ),r=(0,l.md)(J),s=(0,l.md)(Q),[i,o]=a.useState(!1),d=(0,l.md)(W)!==S.Y6.Filter&&i,c=a.useRef(null);(0,eh.ww)(c,()=>o(!1));let u=a.useCallback(e=>{o(!1),t(e.object.id)},[o,t]);return(0,n.jsxs)(eW.dP,{className:L.s.flex1.$,ref:c,allowVim:!0,children:[(0,n.jsx)(eQ,{searchRef:e,setShowSearchResults:o}),d&&(r?(0,n.jsx)(e0,{searchResults:r,selectResult:u}):s?(0,n.jsx)(e1,{text:s}):null)]})}function eQ({searchRef:e,setShowSearchResults:t}){let r,s,i,o,d,c,u=(0,l.md)(W),h=(r=(0,l.md)(p.Cc),s=(0,l.Xr)(K),i=(0,l.Xr)(X),o=(0,l.Xr)(Y),d=a.useRef(0),c=a.useMemo(()=>(0,B.s)(e=>{let t=++d.current;o(!0);let n=new TaskController({priority:"user-visible"});scheduler.postTask(()=>o(!0),{signal:n.signal,delay:300}).catch(()=>{});let a=r.getObject(e);a&&s({status:"searching",results:[{object:a,matches:[{value:e,property:"id",isExact:!0}]}]}),r.getSearch(i).then(t=>t.searchWithText(e)).then(e=>{n.abort(),t===d.current&&s({status:"success",results:e})}).catch(e=>{console.error(e),n.abort(),t===d.current&&s({status:"error",error:e})})},200),[r,i,s,o]),a.useCallback(e=>0===e.length?s({status:"initial"}):c(e),[c,s])),{setKeyboardNavigationElement:f}=(0,eW.M3)({path:[0,0],id:"input"});return(0,n.jsx)("input",{ref:t=>{f(t),e.current=t},type:"text",placeholder:u,className:"search_bar--searchBar--UMQA-",onChange:e=>h(e.target.value),onFocus:()=>t(!0)})}function eZ({children:e}){return(0,n.jsx)("div",{className:L.s.absolute.zIndexModal.colorBg.b1.colorBorder.mt2.overflowAuto.$,style:{maxHeight:450,minWidth:500,boxShadow:"0px 2px 14px var(--color-shadow, rgba(0, 0, 0, 0.15))"},children:e})}function e0({searchResults:e,selectResult:t}){return(0,n.jsx)(eZ,{children:e.map((e,r)=>(0,n.jsx)(e5,{result:e,index:r,onClick:()=>t(e)},e.object.id))})}function e1({text:e}){return(0,n.jsx)(eZ,{children:(Array.isArray(e)?e:[e]).map((e,t)=>(0,n.jsx)("div",{className:L.s.colorBg.colorTextSecondary.px8.py4.$,children:e},t))})}function e5({result:e,index:t,onClick:r}){let{object:s,matches:i}=e,{displayProperties:l}=s,{setKeyboardNavigationElement:o,keyboardNavigationItem:d,isFauxFocused:c}=(0,eW.M3)({path:[1,t],id:s.id});return a.useEffect(()=>{d&&0===t&&d.fauxFocus()},[d,t]),(0,n.jsx)("button",{ref:o,className:eY()(L.s.block.wFull.px4.py8.colorText.flex.itemsCenter.alignLeft.$,"search_bar--searchResult--8iGr1",c&&"search_bar--fauxFocus--6i7Gb"),onClick:r,children:(0,n.jsxs)(P.Y,{spacing:4,children:[(0,n.jsx)(ed.IV,{badges:l.leftBadges}),(0,n.jsx)(ec.nK,{id:s.displayProperties.primaryId}),(0,n.jsx)(eq.R,{className:L.s.overflowHidden.$,text:l.name}),(0,n.jsx)(P.M,{}),i.filter(({property:e})=>!["id","guid","name","type","phase"].includes(e)).map(({property:e,value:t},r)=>(0,n.jsxs)(P.Y,{spacing:4,width:"hug-contents",children:[(0,n.jsxs)("div",{children:[e,":"]}),(0,n.jsx)("div",{children:t})]},r))]})})}var e2=r(824234);function e4({children:e}){return(0,n.jsx)("div",{className:L.s.colorBorder.px8.py4.bb1.bSolid.$,children:(0,n.jsx)(P.Y,{children:e})})}function e6(e){let t={className:"toolbar_components--iconButton--h3x8J",children:(0,n.jsx)(e2.B,{svg:e.svg}),title:e.label,"aria-label":e.label};return"href"in e?(0,n.jsx)("a",{...t,href:e.href,target:"blank"}):(0,n.jsx)("button",{...t,onClick:e.onClick,disabled:e.disabled})}var e3=r(691109),e8=r(176346);function e9({searchRef:e}){let[t,r]=(0,l.fp)(w.jI),[s,i]=(0,l.fp)(w.JN),d=!!a.useContext(w.H$).selectInApp,[c,u]=(0,l.fp)(W),[h,f]=(0,l.fp)(w.bA),[p,g]=(0,l.fp)(et),m=(0,l.md)(er);return(0,n.jsxs)(e4,{children:[(0,n.jsx)(eJ,{searchRef:e}),(0,n.jsxs)("select",{name:"filter-or-search",title:"Determines whether the text box searches or filters",onChange:e=>{u(e.target.value)},defaultValue:c,children:[(0,n.jsx)("option",{value:S.Y6.Search,children:"Search"}),(0,n.jsx)("option",{value:S.Y6.Filter,children:"Filter"})]}),(0,n.jsx)("select",{name:"sort",title:"Sets the left panel sort order",onChange:e=>{let t=e.target.value;o.az.trackDefinedEvent("figmascope.sort_order_change",{order:function(e){switch(e){case S.hX.Position:return"position";case S.hX.Name:return"name";case S.hX.Memory:return"memory";case S.hX.NodeId:return"node_id"}}(t)}),g(t)},defaultValue:p,children:m.map(e=>(0,n.jsxs)("option",{value:e,children:["Sort by ",e]},e))}),d&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("input",{name:"follow-selection",type:"checkbox",checked:h,onChange:e=>f(e.target.checked)}),(0,n.jsx)("label",{htmlFor:"follow-selection",children:"Follow"})]}),(0,n.jsx)(e6,{label:"Select Previous",onClick:()=>{r(),o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"button"})},disabled:!t,svg:e3.A}),(0,n.jsx)(e6,{label:"Select Next",onClick:()=>{i(),o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"button"})},disabled:!s,svg:e8.A}),(0,n.jsx)(eK,{})]})}var e7=r(626022),te=r(105553),tt=r(921424),tr=r(778254),ts=r(135546),tn=r(551683),ta=r(35401),ti=r(217169);function tl({selectedObject:e,diffObject:t,onClose:r}){let s=(0,l.md)(k),[a,i]=(0,l.fp)(f.Oz);return(0,n.jsxs)(e4,{children:[e?a&&t?(0,n.jsx)(tc,{selectedObject:e,diffObject:t,diffState:a,setDiffState:i}):(0,n.jsx)(td,{object:e}):t?(0,n.jsx)(td,{object:t}):(0,n.jsx)(P.M,{}),s&&(0,n.jsx)(tu,{}),(0,n.jsx)(e6,{label:"Help",href:tr.e,svg:ts.A}),r&&(0,n.jsx)(e6,{label:"Close FigmaScope",onClick:r,svg:ti.A})]})}let to=L.s.flex1.ml10.my4.$;function td({object:e}){return(0,n.jsx)("div",{className:to,children:(0,n.jsx)("span",{className:L.s.fontSemiBold.$,children:e.displayProperties.longName})})}function tc({selectedObject:e,diffObject:t,diffState:r,setDiffState:s}){let a=(0,l.Xr)(w.AJ);return(0,n.jsxs)("div",{className:L.s.flex1.ml10.my4.$,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:L.s.colorTextSecondary.$,children:"Diffing "}),(0,n.jsx)("span",{className:L.s.fontSemiBold.$,children:e.displayProperties.longName}),(0,n.jsx)("span",{className:L.s.colorTextSecondary.$,children:" against "}),(0,n.jsx)("span",{className:L.s.fontSemiBold.$,children:t.displayProperties.longName})]}),r&&(0,n.jsx)("div",{className:L.s.colorTextSecondary.mt8.$,children:(0,n.jsxs)(P.Y,{spacing:8,width:"hug-contents",height:"hug-contents",verticalAlignItems:"start",children:[(0,n.jsxs)("span",{children:["Snapshot of"," ",(0,n.jsx)(tt.CY,{onClick:()=>a(r.object.id),className:L.s.colorTextFigjam.fontSemiBold.$,trusted:!0,children:r.object.displayProperties.name}),r.type===f.Lp.Tree&&" and full subtree"," was taken at"," ",r.time.toLocaleTimeString("en-US")]}),(0,n.jsx)(tt.CY,{onClick:()=>s({type:"refresh"}),className:L.s.colorTextDesign.$,trusted:!0,children:"Refresh"}),(0,n.jsx)(tt.CY,{onClick:()=>s({type:"clear"}),className:L.s.colorTextDanger.$,trusted:!0,children:"Finish"})]})})]})}function tu(){let[e,t]=(0,l.fp)(y),r=e.status===u.r.LOADING;return a.useEffect(()=>{t()},[t]),(0,n.jsx)(e6,{label:r?"Fetching scene graph validation failures":"Refetch scenegraph validation failures",onClick:t,svg:r?tn.A:ta.A})}var th=r(687497);function tf({children:e}){return(0,n.jsx)("div",{className:L.s.hFull.$,children:(0,n.jsxs)(P.Y,{direction:"vertical",width:"fill-parent",height:"fill-parent",padding:0,spacing:0,children:[(0,n.jsx)(tp,{}),e]})})}function tp(){let{name:e,metadata:t}=(0,l.md)(p.Cc);return(0,n.jsxs)(P.Y,{direction:"horizontal",width:"fill-parent",height:32,padding:8,spacing:32,backgroundColor:"toolbar",children:[e&&(0,n.jsx)(th.E,{fontWeight:"bold",color:"toolbar",children:e}),t&&Object.entries(t).map(([e,t])=>t&&(0,n.jsxs)("span",{children:[(0,n.jsxs)(th.E,{color:"toolbar-secondary",children:[e,": "]}),(0,n.jsx)(th.E,{color:"toolbar",fontFamily:"monospace",fontWeight:"bold",children:t})]},e))]})}var tg=r(275581);let tm=a.memo(function({embedded:e=!1,emptyStateContent:t,onClose:r,appSelection:s,setAppSelection:a}){let i=(0,l.md)(p.lu);switch(i.status){case u.r.INIT:return t??(0,n.jsx)(I.zG,{});case u.r.LOADING:return(0,n.jsx)(I.zG,{});case u.r.FAILURE:return(0,n.jsx)(I.rf,{error:i.error});case u.r.SUCCESS:}if(0===i.value.primaryResource.rootObjects.length)return(0,n.jsx)(I.rf,{error:"No root objects found. This is likely a bug - please report in #figmascope."});let o=(0,n.jsx)(tx,{appSelection:s,setAppSelection:a,onClose:r});return e?o:(0,n.jsx)(tf,{children:o})});function tx({onClose:e,appSelection:t,setAppSelection:r}){let s=a.useRef(null),g=a.useRef(null),{windowInnerWidth:m}=(0,d.l)(),[x,b]=(0,l.fp)(tb),[v,j]=(0,l.fp)(tv),[k,C]=(0,i.i)({onDrag(e){let t=e.clientX/m;b(`${(100*t).toFixed(2)}%`)}}),[S,I]=(0,i.i)({onDrag(e){let t=g.current;if(!t)return;let r=(e.clientX-t.getBoundingClientRect().left)/t.clientWidth;j(`${(100*r).toFixed(2)}%`)}}),_=(0,l.Xr)(w.jI),T=(0,l.Xr)(w.JN),N=a.useCallback(e=>{let t=s.current;document.activeElement!==t&&(e.keyCode===c.Uz.FORWARD_SLASH&&t?(t.focus(),e.preventDefault()):e.keyCode===c.Uz.BRACKET_LEFT?(o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"keyboard"}),_()):e.keyCode===c.Uz.BRACKET_RIGHT&&(o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"keyboard"}),T()))},[_,T]),E=(0,l.md)(p.Cc);window.figmaScope=E,window.figmaScopeScene=E,function(e){let[t,r]=(0,l.fp)(y);t.status===u.r.SUCCESS&&e?.setSceneGraphValidationInfo?.(t.value),(0,a.useEffect)(()=>{r()},[r])}(E);let M=(0,l.md)(w.AJ),A=(0,l.md)(w.gg),F=(0,l.md)(f.tH);return(0,n.jsx)(w.q,{appSelection:t,setAppSelection:r,children:(0,n.jsxs)("div",{className:tg.zr,style:h.sx.if(k||S,{cursor:"ew-resize"}).$,onKeyDown:N,children:[(0,n.jsxs)("div",{className:tg.Pd,style:{width:x},children:[(0,n.jsx)(e9,{searchRef:s}),(0,n.jsxs)(e7.o,{className:tg._H,children:[(0,n.jsx)("div",{...C({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,n.jsx)(ew,{appSelection:t})]})]}),(0,n.jsxs)("div",{className:tg.io,children:[(0,n.jsx)(tl,{selectedObject:A,diffObject:F,onClose:e}),(A||F)&&(0,n.jsxs)("div",{className:tg._t,ref:g,children:[(0,n.jsxs)(e7.o,{className:tg.S3,style:{width:v},children:[(0,n.jsx)("div",{...I({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,n.jsx)(te.P,{panel:"middle",items:A?.rawProperties,diffItems:F?.rawProperties,extraItems:void 0},M)]}),(0,n.jsx)(e7.o,{className:tg.xK,children:(0,n.jsx)(te.P,{panel:"right",items:A?.computedProperties,diffItems:F?.computedProperties,extraItems:E.getAdditionalProperties?.(M)},M)})]})]})]})})}let tb=(0,S.Sv)("leftPanelWidth","35%"),tv=(0,S.Sv)("rightPanelWidth","50%")},196438(e,t,r){r.d(t,{BP:()=>u,_J:()=>d,xO:()=>o});var s=r(885705),n=r(211357),a=r(563564),i=r(116682),l=r(938077);let o=(e,t)=>async r=>{if(!e){let e="Thread ID is required to upload tool result to blob store";return(0,a.fL)(new a.fC(e),"upload_to_blob_store",{fileKey:t}),{state:"uploadFailed",error:e}}let s=await l.M.uploadJsonBlobs(t,e,[r]);if(s.success){let n=s.resultItems[0];if(!n){let r="Blobstore upload succeeded but no result was returned";return(0,a.fL)(new a.fC(r),"upload_to_blob_store",{fileKey:t,threadId:e}),{state:"uploadFailed",error:r}}return(0,a.pF)("Uploaded tool result to blob store",n),{state:r.success?"success":"toolFailed",blobstoreContentKey:n.contentKey}}{let r=`Failed to upload tool result to blob store: ${s.error}`;return(0,a.fL)(new a.fC(r),"upload_to_blob_store",{fileKey:t,threadId:e}),{state:"uploadFailed",error:r}}},d=({fileKey:e,threadId:t,userFlow:r})=>async n=>{let i=await r.measureDurationAsync("uploadContentToBlobstore",async r=>{let s=await l.M.uploadBlobs(e,t,n);return r.addContext({statusCode:s.success?"200":"500",aiChatThreadId:t}),s});if(!i.success)return(0,a.fL)(new a.Tv(`Failed to upload content to blobstore: ${i.error}`),"upload_to_blob_store",{fileKey:e,threadId:t,cause:i.error,contentTypes:JSON.stringify([...new Set(n.map(e=>e.contentType).filter(Boolean))])}),i;let o=i.resultItems.length,d=i.resultItems.filter(e=>e.entityAlreadyExisted).length;return(0,a.nH)(`Uploaded ${o} items to Blobstore (${d} already existed)`,i),r.addAction("uploadedToBlobstore",s.$.INFO,{numUploaded:o,numAlreadyExisted:d}),i};async function c(e){let t,r;try{let s=await i.Ay.crossOriginGet(e,null,{responseType:"blob",retryCount:2});200===s.status?t=s.data:r=s.cause??Error(`Failed to fetch blob (${s.status}): ${s.data}`)}catch(e){r=e instanceof Error?e:Error(String(e))}return{blob:t,error:r}}let u=new n.X(l.M,(e,t)=>(0,a.fL)(e,"ai_chat_blobstore_cache",t),c,a.nH)},251823(e,t,r){r.d(t,{q:()=>c});var s=r(885705),n=r(355237),a=r(563564),i=r(539236),l=r(995029),o=r(559365);let d=new n.f,c=(0,o.nh)(async e=>{let{fileKey:t,context:r,plan:n}=e,o="ai_assistant"===r?a.fC:a.Tv,c=n.planRecordId;if(!c){let e="No plan record id, cannot create thread";return(0,a.fL)(new o(e),"create_thread_record",{fileKey:t}),{status:"error",error:e}}let u=async()=>{let n=i.J.createVital(`${r}.chat_sdk.thread_creation_time`,{level:s.$.INFO});n.start();let d=await (0,a.kA)(n,()=>l.NH.createThread({fileKey:t,threadType:"ai_assistant"===r?"assistant":void 0,planId:c,privacyMode:"code_chat"===r?"file":"user",nodeGuid:"code_chat"===r?e.nodeGuid:void 0},{retryCount:3}));if(n.stop(),!d.success){let{statusCode:e,cause:r,errorData:s}=d,n=`ApiAiChat.createThread failed, status: ${e}`;return(0,a.fL)(new o(n),"create_thread_record",{fileKey:t,statusCode:e,cause:r,errorData:s}),{status:"error",error:n}}return d.data.meta.alreadyExists,{status:"created",threadId:d.data.meta.threadId}};if("code_chat"!==r)return await u();{let s=`${t}:${r}:${e.nodeGuid}`;return await d.run(s,u)}})},377587(e,t,r){r.d(t,{Sw:()=>m,bg:()=>v,bz:()=>C,cD:()=>y,dJ:()=>x,p:()=>j,qM:()=>k,th:()=>b});var s=r(105652),n=r(825204),a=r(227654),i=r(575877),l=r(350923),o=r(563564),d=r(140979),c=r(668522),u=r(94241),h=r(508295),f=r(644350);if(1464==r.j)var p=r(28394);function g(e){return s.useMemo(()=>"errors"!==e.status?[]:e.errors.filter(e=>!e.retriable),[e.status,e.errors])}function m({isEnabled:e,fileKey:t,nodeGuid:r}){let n=(0,h.iZ)(),a=e&&t&&r&&n,i=(0,d.Rs)((0,f.Zrv)(a?{ownerId:t,nodeGuid:r}:null)),l=i.data?.nodeAiChatThreads?.[0]??null,c=g(i);return s.useEffect(()=>{e&&0!==c.length&&(0,o.fL)(new o.Tv("Errors occurred while querying Livegraph NodeAiChatThreadsView"),"nodeaichatthreadsview_initial_view_fail",{subscriptionErrors:JSON.stringify(c),fileKey:t,nodeGuid:r})},[e,c,t,r]),{threadId:l?.id??null,subscriptionStatus:i.status,latestUserMessage:l?.latestUserMessage??null}}function x(e,t,r,n,a){let i=(0,d.Rs)((0,f.r3i)(e?{ownerId:e}:null)),l=g(i);s.useEffect(()=>{0!==l.length&&(0,o.fL)(new o.fC("Errors occurred while querying Livegraph FileAiChatThreadsView"),"fileaichatthreadsview_initial_view_fail",{subscriptionErrors:JSON.stringify(l),fileKey:e})},[l,e]);let c=i.data?.fileAiChatThreads?.[0]?.id??null,u="loaded"!==i.status,[h,p]=s.useState(null),m=h??c,x=e&&m?{ownerId:e,id:m}:null,v=(0,d.Rs)((0,f.A6w)(x)),j=v.data?.activeAiChatThread??null;return s.useEffect(()=>{if(!j||!m||a)return;let e=j.messages.map(b);p(e=>(e!==m&&(0,o.pF)(`Livegraph threadId updating: ${e} => ${m}`),m));let s=n();e.length>s.length+t&&((0,o.pF)("LiveGraph ActiveAiChatThread updating =>",e),r(e))},[j,n,r,m,t,a,p]),{threadId:a?null:m,setThreadId:p,isLoadingThreadId:u,isLoadingMessages:"loading"===v.status}}function b(e){let t=(e.parts??[]).map(({partType:e,contentPb:t,isContentCompressed:r,blobstoreContentKey:s})=>{if(!(0,n.pQ)(e))return(0,o.D5)(`Unknown message part type when converting Livegraph message to AiChatMessage: ${e}. This part will be ignored.`),null;let{type:i,...l}=(0,n.H)(e,t,{isContentCompressed:(0,c.oA)(r)??!1});return(0,a.N)({type:i,contentJson:l,blobstoreContentKey:s})}).filter(e=>null!==e);return(0,i.O)({id:e.id,role:e.role,index:"messageIndex"in e?e.messageIndex:void 0,content:t,createdAtMs:e.createdAt.getTime(),clientId:e.clientId??void 0,userId:"user"in e?e.user?.id??void 0:void 0,guid:"nodeGuid"in e?e.nodeGuid??void 0:void 0,scenegraphSentAt:"scenegraphSentAt"in e?e.scenegraphSentAt??void 0:void 0,makeVersion:(()=>{if(!("makeVersion"in e))return;let t=(0,c.oA)(e.makeVersion);if(t)return{id:t.id,versionNumber:parseInt(t.versionNumber),title:t.title??void 0,codeSnapshotKey:t.codeSnapshotKey??void 0,createdAt:t.createdAt}})()})}let v=200;function j({chatMessagesNode:e,disabled:t}){let r=(0,l.md)(u.ze),s=!t&&r&&e,{threadId:n,subscriptionStatus:a}=m({isEnabled:!!s,fileKey:r,nodeGuid:e?.guid||""}),i=(0,d.Rs)((0,f.nmx)(!t&&s&&n?{ownerId:r,id:n,firstPageSize:v}:null));return{thread:i.data?.activeAiChatThread??null,subscriptionStatus:i.status??a}}let k={numberOfMessages:0,lastMessageUpdatedAt:new Date(0),lastMessageId:"",lastMakeVersionId:null,latestMakeVersionUpdatedAt:new Date(0)};function y(e){let t=e.length,r=e[t-1],s=null,n=new Date(0);if((0,p.F)())for(let t=e.length-1;t>=0;t--){let r=e[t];if(!r)continue;let a=(0,c.oA)(r.makeVersion);a&&(s||(s=a.id),a.updatedAt>n&&(n=a.updatedAt))}return{numberOfMessages:t,lastMessageUpdatedAt:r?.updatedAt??new Date(0),lastMessageId:r?.id??"",lastMakeVersionId:s,latestMakeVersionUpdatedAt:n}}function C(e,t){return null!=e&&null!=t&&e.numberOfMessages===t.numberOfMessages&&e.lastMessageUpdatedAt.getTime()===t.lastMessageUpdatedAt.getTime()&&e.lastMessageId===t.lastMessageId&&e.lastMakeVersionId===t.lastMakeVersionId&&e.latestMakeVersionUpdatedAt.getTime()===t.latestMakeVersionUpdatedAt.getTime()}},98594(e,t,r){r.d(t,{LT:()=>u,_W:()=>d,lV:()=>c});var s=r(350923),n=r(563564),a=r(514062);if(1464==r.j)var i=r(120530);let l={messages:[]},o=(0,a.H)(l);function d(e,t,r){if(!(0,i.z)("make_chat_sdk_read"))return void c(e);let a=s.zl.get(o(e)).messages;a.length>0&&(0,n.D5)("Appending to pending chat messages before LiveGraph confirmation",{nodeGuid:e,threadId:r??"unknown",existingPendingCount:a.length,newMessageCount:t.length,totalPendingCount:a.length+t.length}),s.zl.set(o(e),{messages:[...a,...t]})}function c(e,t){if(void 0===t)return void s.zl.set(o(e),l);let r=s.zl.get(o(e)).messages.slice(t);s.zl.set(o(e),{messages:r})}function u(e){return(0,s.md)(o(e)).messages}},129605(e,t,r){r.d(t,{H:()=>s});class s{constructor(){this.listeners=new Map}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{this.listeners.get(e)?.delete(t)}}emit(e){let t=this.listeners.get(e.type);t&&t.forEach(t=>{t(e)})}clear(){this.listeners.clear()}}},434138(e,t,r){if(r.d(t,{y:()=>n}),1464==r.j)var s=r(129605);class n extends(1464==r.j?s.H:null){}},687478(e,t,r){r.d(t,{KF:()=>m,YP:()=>x,di:()=>v,qD:()=>b});var s=r(105652),n=r(624918),a=r(196438),i=r(251823),l=r(377587),o=r(563564),d=r(94241);if(1464==r.j)var c=r(487817);var u=r(72655);if(1464==r.j)var h=r(120530);if(1464==r.j)var f=r(928832);if(1464==r.j)var p=r(184050);function g(e){return!(0,h.z)("make_chat_sdk_force_enable_killswitch")&&e?.editorType===c._Y.FIGMAKE}function m({chatMessagesNode:e,disabled:t}){let r,f=(0,d.q5)(),m=f?.key??null,x=!!f?.canEdit;e=t?null:e,s.useEffect(()=>{m&&a.BP.clearCacheIfFileKeyChanged(m)},[m]);let{status:b,data:v}=(0,u.Vc)(m),j="loaded"===b,k=(0,p.gO)(e),y=!!(j&&v&&f&&(g(f)||function(e){switch(e.editorType){case c._Y.FIGMAKE:return!0;case c._Y.SITES:case c._Y.DESIGN:return(0,h.z)("make_chat_sdk_sites_and_design");default:return!1}}(f))),{chatSdkState:C,chatSdkStatus:w}=function({fileKey:e,userCanEditFile:t,shouldQueryChatSdkState:r,chatMessagesNode:n,plan:a}){let d=s.useRef(!1),c=n?.guid||"",{threadId:u,subscriptionStatus:h}=(0,l.Sw)({isEnabled:!!(r&&e&&c),fileKey:e,nodeGuid:c}),f=s.useRef(e),p=s.useRef(c),[g,m]=s.useState({threadId:u,errorOnCreateThread:!1}),x=null!==u&&u!==g?.threadId,b=e!==f.current||c!==p.current;(x||b)&&(f.current=e,p.current=c,m({threadId:u,errorOnCreateThread:!1}));let v=e&&c&&"loaded"===h&&a&&r,j=v&&!t&&null===u;return v&&null===u&&t&&!d.current&&(d.current=!0,(0,i.q)({context:"code_chat",fileKey:e,plan:a,nodeGuid:c}).then(e=>{if("error"===e.status&&m({threadId:null,errorOnCreateThread:!0}),"created"===e.status){let{threadId:t}=e;(0,o.nH)(`Figmake AiChatThread created, id: ${t}`),m({threadId:t,errorOnCreateThread:!1})}})),s.useMemo(()=>{let{threadId:e,errorOnCreateThread:t}=g,r=h;return(t?r="errors":j&&(r="disabled"),e)?{chatSdkState:{threadId:e},chatSdkStatus:r}:{chatSdkState:void 0,chatSdkStatus:r}},[g,h,j])}({fileKey:m,userCanEditFile:x,chatMessagesNode:e,plan:v,shouldQueryChatSdkState:y});if(g(f)){if(y&&"errors"===w){let e=new o.Tv("Failed to initialize or create AiChatThread");throw(0,o.fL)(e,"create_thread_record",{fileKey:m,chatSdkStatus:w}),e}r=!0}else r=y&&"errors"!==w&&"disabled"!==w;let S=(0,p.eW)(e,m,C?.threadId??null),I=r&&(0,h.z)("make_chat_sdk_read");return s.useMemo(()=>{let t=I?S:k,s=[k];r&&s.push(S);let a={readingSource:t,writingSinks:s,isInitialized:!!(j&&e&&(!r||C)),node:e,chatSdkState:C,chatSdkPhase1Enabled:r,nodeChatSource:k};return new n.F1(a)},[e,k,S,I,C,r,j])}function x({overrideCodeLibraryNode:e,disabled:t}){let r=(0,f.hk)();return m({chatMessagesNode:void 0!==e?e:r,disabled:t})}function b({codeFileNode:e,disabled:t}){return m({chatMessagesNode:e,disabled:t})}function v({codeFileNode:e,disabled:t}){return m({chatMessagesNode:e,disabled:t})}},184050(e,t,r){r.d(t,{CQ:()=>y,HL:()=>I,eW:()=>S,gO:()=>k});var s=r(105652),n=r(624918),a=r(130827),i=r(868271),l=r(426018),o=r(384078),d=r(350923),c=r(196438),u=r(377587),h=r(98594),f=r(563564),p=r(668522),g=r(208501),m=r(949038),x=r(514062);if(1464==r.j)var b=r(120530);let v="null-hash",j=(0,x.H)({hash:v,messages:[]});function k(e){let t=e?.guid||"",[r,n]=(0,d.fp)(j(t)),a=(0,d.Pj)(),l=s.useMemo(()=>!!(e&&r.hash!==v),[r.hash,e]),o=s.useCallback(()=>{e&&n({hash:e.chatMessagesHash??v,messages:e.chatMessages_DEPRECATED||[]})},[e,n]),c=(0,m.$I)((e,t)=>t?.chatMessagesHash??v,e);s.useEffect(()=>{e&&c&&c!==r.hash&&o()},[o,e,c,r.hash,t]);let u=s.useCallback(()=>a.get(j(t)).messages??[],[a,t]),h=s.useCallback((r,s,n)=>{if(!l||!e)return;if(null!==s.flushFileSeqNum&&s.flushFileSeqNum<0)throw new f.Tv("appendChatMessages: flushFileSeqNum must be >= 0");let i=(0,g.r)(()=>e.appendChatMessages(r));if(!i.success)throw(0,f.fL)(new f.Tv("appendChatMessages failed in C++"),"chat_controller_append_messages",{nodeGuid:t,error:i.error}),new f.Tv(`appendChatMessages failed in C++: ${i.error}`);a.set(j(t),{hash:i.chatMessagesHash,messages:[...i.existing,...i.appended]})},[l,e,a,t]),p=s.useCallback((r,s)=>{if(!l||!e||0===r.length)return;if(null!==s.flushFileSeqNum&&s.flushFileSeqNum<0)throw new f.Tv("editChatMessages: flushFileSeqNum must be >= 0");(0,i.z7)(r);let n=(0,g.r)(()=>e.editChatMessages(r));if(!n.success)throw(0,f.fL)(new f.Tv("editChatMessages failed in C++"),"chat_controller_edit_messages",{nodeGuid:t,error:n.error}),new f.Tv(`editChatMessages failed in C++: ${n.error}`);a.set(j(t),{hash:n.chatMessagesHash,messages:n.updatedMessages})},[l,e,a,t]);return s.useMemo(()=>({getMessages:u,appendMessages:h,editMessages:p,SLOW_populateNodeChatCache:o,isInitialized:l}),[u,h,p,o,l])}function y(e){return(0,d.md)(j(e)).hash!==v}let C=(0,x.H)({messages:[]}),w=(0,x.H)({messages:[]});function S(e,t,r){let n=e?.guid||"",a=function(e,t,r){let n=e?.guid||"",[a,i]=(0,d.fp)(C(n)),g=(0,h.LT)(n),m=s.useRef(u.qM),x=!(0,b.z)("make_chat_sdk_read")&&(0,b.z)("make_chat_sdk_client_shadow_reads_v2"),v=((0,b.z)("make_chat_sdk_read")||(0,b.z)("make_chat_sdk_client_shadow_reads_v2"))&&e,{thread:j,subscriptionStatus:k}=(0,u.p)({chatMessagesNode:e,disabled:!v}),y=(0,p.oA)(j?.messageCount),w=s.useMemo(()=>[...j?.paginatedMessages??[]].reverse(),[j]),S=(0,b.z)("make_chat_sdk_read")&&void 0!==y&&y>0&&0===a.messages.length,I="loaded"!==k,_=I||S,T=s.useMemo(()=>!!(!v||j&&!_),[v,j,_]);s.useEffect(()=>{if(I||!j||!t||!r)return;if(x)return void(0,f.nH)("[Shadow read] Received LiveGraph data (not used for display)",{threadId:j.id,messageCount:w.length});let e=(0,u.cD)(w);if(!(0,u.bz)(e,m.current)){let s=w.map(u.th);i({messages:s}),m.current=e,(0,f.nH)("[Pre-blobstore] Updated local cache with AiChatMessages",{thread:j,aiChatMessages:s}),(0,l.V)({aiChatMessages:s,partTypesToHydrate:o.NE,shouldHydrateToolCallback:o.eY,blobstoreCache:c.BP,threadId:r,fileKey:t,logWarn:f.D5}).then(({aiChatMessages:t,numHydratedRefParts:r})=>{r>0?(i({messages:t}),m.current=e,(0,f.nH)("[Post-blobstore] Updated local cache with hydrated AiChatMessages",{aiChatMessages:t,numHydratedRefParts:r})):(0,f.nH)("No ref parts to hydrate, skipping re-render")}).catch(e=>{(0,f.nH)("Error hydrating chat messages from blobstore",e),m.current=u.qM})}},[j,I,i,w,t,r,n,x]);let N=s.useMemo(()=>{if(0===g.length)return a.messages;let e=a.messages[a.messages.length-1],t=e?.createdAtMs;if(!t)return[...a.messages,...g];let r=0;for(r=0;r<g.length;r++){let e=g[r];if(!e?.createdAtMs||e.createdAtMs>t)break}r>0&&(0,h.lV)(n,r);let s=g.slice(r);return 0===s.length?a.messages:[...a.messages,...s]},[a.messages,g,n]),E=s.useCallback(()=>N,[N]),M=s.useCallback(()=>{},[]),A=s.useCallback((e,t,r)=>{},[]),F=s.useMemo(()=>{if(!(0,b.z)("make_chat_sdk_read"))return;let e=j?.paginatedMessages,t=!!(_||e?.isLoadingNextPage);return{loadNextPage:t=>{e&&((0,f.nH)("Loading next page of messages",{count:t??u.bg}),e.loadNext(t??u.bg))},hasMore:e?.hasNextPage()??!1,isLoading:t,totalCount:y}},[j,_,y]);return s.useMemo(()=>({getMessages:E,editMessages:M,appendMessages:A,isInitialized:T,pagination:F}),[E,M,A,T,F])}(e,t,r),i=a.getMessages(),[g,m]=(0,d.fp)(w(n)),x=s.useMemo(()=>!!a.isInitialized&&(!(i.length>0)||0!==g.messages.length),[a.isInitialized,i.length,g.messages.length]);s.useEffect(()=>{if(0===i.length)return;let e=i.map(l.Y);m({messages:e}),(0,f.nH)("Set NodeChat cache with converted AiChatMessages",{aiChatMessages:i,convertedMessages:e})},[i,m]);let v=s.useCallback(()=>g.messages,[g.messages]),j=s.useCallback(()=>{},[]),k=s.useCallback((e,t,r)=>{},[]),y=s.useMemo(()=>{if(!a.pagination)return;let e=a.pagination.isLoading||!x;return{...a.pagination,isLoading:e}},[a.pagination,x]);return s.useMemo(()=>({getMessages:v,editMessages:j,appendMessages:k,isInitialized:x,pagination:y}),[v,j,k,x,y])}function I(e){let t=e?.getMessages();return s.useMemo(()=>t?(0,a.Qf)((0,n.BM)(t),!1):[],[t])}},547519(e,t,r){if(r.d(t,{B5:()=>i,PK:()=>l,WR:()=>o}),1464==r.j)var s=r(935759);var n=r(838719),a=r(923486);function i(e){return(0,s.yS)(e)}function l(e){let t=o(),r=(0,a.fF)()??null;return t&&r?(0,s.yS)(`${e}${t}${r}`):null}function o(){return(0,n.default)().user_data?.id??null}},3896(e,t,r){r.d(t,{Fq:()=>I,tT:()=>S,Ay:()=>_});var s=r(105652),n=r(805590),a=r(97004),i=r(523924),l=r(806266),o=r(741542),d=r(350923),c=r(181645),u=r(878529),h=r(94241),f=r(630222),p=r(351823),g=r(331850),m=r(373949),x=r(434138),b=r(14976),v=r(454125),j=r(790538),k=r(928832),y=r(370472),C=r(547519),w=r(626755);let S=1,I=(0,p.Wh)(()=>(0,d.eU)(null));function _({fileKey:e,fileId:t,isFoundryEnabled:r,surface:p,mode:S}){S=S??w.vq.FULL;let _=new URL((0,d.md)(y.jD)).host,T=(0,s.useRef)(new j.b({isFoundry:!0,surface:p})),N=(0,g.No)(),E=N.unwrapOr(null)?.key?.parentId||null,M=N.unwrapOr(null)?.tier,A=(0,s.useRef)(new m.w({surface:p,planTier:M})),F=(0,s.useRef)(new x.y),[L,P]=(0,s.useState)(!1),z=(0,k.hk)(),D=(0,s.useMemo)(()=>!!z,[z]),{user:O}=(0,b.$W)(z?.guid),$=(0,f.KP)(),R=!!O&&O.sessionID!==$,U=((0,v.ne)()?.size??0)>0,H=(0,s.useMemo)(()=>{let e=performance.getEntriesByType("navigation");return e.length>0&&e[0]?.type==="reload"},[]),[B,V]=(0,s.useState)(!1),G=function(){let[e,t]=(0,s.useState)(document.visibilityState);return(0,s.useEffect)(()=>{let e=()=>{t(document.visibilityState)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),e}(),K=(0,s.useMemo)(()=>!L&&e&&r?{originHost:_,fileKey:e,logger:(0,w.gR)(),perfTracker:T.current,previewUpdateTracker:A.current,viteServerLifecycle:F.current,planTier:M,chatMessagesNodeGuid:z?.guid,mode:S}:null,[L,e,r,_,M,z?.guid,S]),[X,Y]=(0,s.useState)(K?new w.Ay(K):null),q=(0,s.useCallback)(async()=>{X&&"visible"===document.visibilityState&&await X.recreateSandbox("user-hard-refresh")},[X]),W=(0,s.useCallback)(()=>{X?.flushSandboxSyncer()},[X]),J=(0,h.q5)()?.canEdit;(0,s.useEffect)(()=>{if(r&&J&&1>(0,a.ft)()){let t=(0,a.ft)();l.l7.system("set-local-code-library-format",()=>{(0,a.lK)(1)}),e&&c.az.trackDefinedEvent("foundry.clf_upgrade",{fileKey:e,previousCodeLibraryFormat:t.toString(),newCodeLibraryFormat:"1"})}},[r,J,e]);let[Q,Z]=(0,d.fp)(I);(0,s.useEffect)(()=>{r||Z(null)},[r,Z]);let ee=(0,s.useCallback)(t=>{switch(t.state){case w.TT.PROVISIONING:Z({reinitialize:q,flushSandboxSyncer:W,state:w.TT.PROVISIONING,perfTracker:T.current,previewUpdateTracker:A.current,viteServerLifecycle:F.current});break;case w.TT.CACHED_PREVIEW:Z({reinitialize:q,flushSandboxSyncer:W,state:w.TT.CACHED_PREVIEW,cachedPreview:t.cachedPreview,perfTracker:T.current,previewUpdateTracker:A.current,viteServerLifecycle:F.current});break;case w.TT.REPROVISIONING:Z({reinitialize:q,flushSandboxSyncer:W,state:w.TT.REPROVISIONING,reprovisioningReason:t.reprovisioningReason,perfTracker:T.current,previewUpdateTracker:A.current,viteServerLifecycle:F.current});break;case w.TT.PROVISIONED:A.current.setProvider(X?.provider),Z({reinitialize:q,flushSandboxSyncer:W,state:w.TT.PROVISIONED,url:t.url,perfTracker:T.current,previewUpdateTracker:A.current,viteServerLifecycle:F.current,sandboxId:t.sandboxId});break;case w.TT.FAILED:{let r=(0,a.ft)();(0,o.getFeatureFlags)().make_foundry_disable_fallback_to_esbuild?Z({reinitialize:q,flushSandboxSyncer:W,state:w.TT.FAILED,error:t.error.message,perfTracker:T.current,previewUpdateTracker:A.current,viteServerLifecycle:F.current}):(P(!0),Z(null),e&&c.az.trackDefinedEvent("foundry.fallback_to_esbuild",{fileKey:e,codeLibraryFormat:r.toString(),error:t.error.message,planTier:M,provider:X?.provider,multiplayerOnline:(0,u.eN)()}));break}default:(0,i.S9)(t,void 0,"Unknown sandbox state change")}},[X,e,Z,q,W,M]),et=(0,s.useCallback)(e=>{X&&X.initializeCode(e)},[X]);return(0,s.useEffect)(()=>{X&&(X.attachHandlers({onStateChange:ee}),X.attachProperties({otherSessionRunningAgentLoop:R,designToCodeGenerating:U}))},[X,R,U,ee]),(0,s.useEffect)(()=>{K?X||Y(new w.Ay(K)):Y(null)},[K,X]),(0,s.useEffect)(()=>{X&&!X.initialized&&D&&"visible"===G&&(Z({reinitialize:q,flushSandboxSyncer:W,state:w.TT.PROVISIONING,perfTracker:T.current,previewUpdateTracker:A.current,viteServerLifecycle:X.viteServerLifecycle}),X.initializeSandbox())},[X,D,Z,q,W,G]),(0,s.useEffect)(()=>()=>{X?.destroy()},[X]),(0,s.useEffect)(()=>{!B&&X&&e&&(c.az.trackDefinedEvent("foundry.file_open",{fileKey:e,sourceCodeHash:(0,n.N)().getSourceCodeHash(),codeLibraryFormat:(0,a.ft)().toString(),surface:p,hardReloaded:H,planTier:M,provider:X?.provider}),c.az.trackDefinedEvent("foundry.session_context",{fileKey:e,fileKeyHash:(0,C.B5)(e),routingKey:(0,C.PK)(e)??void 0,fileId:t??void 0,userId:(0,C.WR)()??void 0,planParentId:E??void 0,planTier:M,provider:X?.provider}),V(!0))},[H,p,B,X,e,t,E,M]),(0,s.useMemo)(()=>null===Q&&!L&&r?{sandbox:{reinitialize:q,flushSandboxSyncer:W,state:w.TT.PROVISIONING,perfTracker:T.current,previewUpdateTracker:A.current,viteServerLifecycle:F.current},setCodeReady:et}:{sandbox:Q,setCodeReady:et},[Q,L,r,et,q,W])}},491220(e,t,r){r.d(t,{t:()=>a});var s=r(105652),n=r(239976);let a=(0,s.memo)(function(e){return(0,n.jsx)("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",...e,"data-fpl-icon-size":"16",children:(0,n.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",d:"M7.646 6.404a.5.5 0 0 1 .707 0l2.122 2.121a.5.5 0 0 1-.708.707L8 7.465 6.232 9.232a.5.5 0 0 1-.707-.707z"})})})},130827(e,t,r){r.d(t,{EY:()=>d,Qf:()=>l,gG:()=>o});var s=r(624918),n=r(491852);if(1464==r.j)var a=r(403570);var i=r(932858);function l(e,t){let r=(0,a.A)(e);return r?r.filter(e=>e.type!==n.K$p.TOOL_MESSAGE).reduce((e,r)=>{let a=r.type===n.K$p.ASSISTANT_MESSAGE,l=r.toolCalls.length>0,o=0===(0,s.H5)(r,t).plainText.length;if(a&&l&&o){let t=e[e.length-1];return t?.type===n.K$p.ASSISTANT_MESSAGE&&(t.toolCalls=i([...t.toolCalls,...r.toolCalls],"toolCallId")),e}return[...e,r]},[]):[]}function o(e){let{hidden:t,errors:r}=e;return!!t&&!!r&&r.length>0&&e.origin!==s.zm.FIX_ERRORS_BUTTON}function d(e){let t=e.slice().reverse().find(e=>e.type===n.K$p.USER_MESSAGE);return t?t.id:null}}}]);

//# debugId=f51550c7-2f8f-5d32-af21-64e960a684ba

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/a81e5651bffacad9c54e6ceb5cf017d3221a68de/3925-9e00c7098e641534.min.js.map