"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="4c613be0-b6a1-56d7-9f8f-c76d17efcf1e")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([["938"],{355237(e,t,a){a.d(t,{f:()=>o});class o{constructor(){this.inFlightOperations=new Map}run(e,t){let a=this.inFlightOperations.get(e);if(a)return a;let o=(async()=>{try{return await t()}finally{this.inFlightOperations.delete(e)}})();return this.inFlightOperations.set(e,o),o}}},28394(e,t,a){a.d(t,{F:()=>r});var o=a(442549);if(/^(1464|2036)$/.test(a.j))var s=a(120530);function r(){return o.v.getFeatureGate("make_version_history_in_chat")&&(0,s.z)("make_chat_sdk_read")}},426018(e,t,a){a.d(t,{V:()=>p,Y:()=>c});var o=a(140855),s=a(491852),r=a(384078),n=a(624918),i=a(1556);if(/^(1464|2036)$/.test(a.j))var l=a(523924);function c(e){let t={userId:e.userId,messageGuid:e.guid,createdAtMs:e.createdAtMs,scenegraphSentAt:e.scenegraphSentAt};switch(e.role){case"user":{let a=function(e,t){let a=(0,i.XL)(e,"code-chat-snapshot-restore");if(a){let o={type:"restore",plainText:"",codeSnapshot:{codeSnapshotKey:a.legacyS3CodeSnapshotKey,blobstoreContentKey:a.blobstoreContentKey},title:a.title,makeVersion:e.makeVersion},r=d(s.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(o),r}let o=(0,i.XL)(e,"code-chat-manual-edit");if(o){let a={type:"manual_edit",plainText:"",changedFiles:o.changedFiles,codeSnapshot:o.legacyS3CodeSnapshotKey?{codeSnapshotKey:o.legacyS3CodeSnapshotKey}:void 0,title:o.title,makeVersion:e.makeVersion},r=d(s.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(a),r}let r=(0,i.XL)(e,"code-chat-duplicated-file");if(r){let e={type:"duplicated_file",plainText:r.plainText,fileKeyHash:r.fileKeyHash},a=d(s.K$p.SYSTEM_MESSAGE,t);return a.textContent=JSON.stringify(e),a}let n=(0,i.XL)(e,"code-chat-inserted-template");if(n){let a={type:"inserted_template",plainText:n.plainText,codeSnapshot:{codeSnapshotKey:n.legacyS3CodeSnapshotKey,blobstoreContentKey:n.blobstoreContentKey},makeVersion:e.makeVersion},o=d(s.K$p.SYSTEM_MESSAGE,t);return o.textContent=JSON.stringify(a),o}let l=(0,i.XL)(e,"code-chat-deleted-chat-history");if(l){let e={type:"deleted_chat_history",plainText:"",userId:l.userId,timestamp:Number(l.timestamp)},a=d(s.K$p.SYSTEM_MESSAGE,t);return a.textContent=JSON.stringify(e),a}}(e,t);if(a)return a;let r={plainText:"",imports:[]};for(let t of e.content)switch(t.type){case"text":r.plainText=t.text;break;case"enabled-libraries":case"selected-node-ids":break;case"code-chat-model-config-version":r.modelConfigVersion=t.modelConfigVersion;break;case"code-chat-library-keys":r.libraryKey=t.libraryKeys[0],r.libraryKeys=[...t.libraryKeys];break;case"code-chat-errors":r.errors=[...t.errors],r.hidden=!0,r.plainText="";break;case"cortex-request-uuid":r.requestUuid=t.requestUuid;break;case"code-chat-origin":r.origin=t.origin;break;case"code-chat-inspected-component":r.inspectedComponent={filePath:t.filePath,tagName:t.tagName};break;case"code-chat-inspected-library":r.inspectedLibrary={folderPath:t.folderPath,libraryName:t.libraryName};break;case"code-chat-snapshot-restore":case"code-chat-manual-edit":case"code-chat-duplicated-file":case"code-chat-inserted-template":case"code-chat-deleted-chat-history":throw new o.T(`${t.type} should have been handled by maybeHandleNodeChatSystemMessage. Probably a bug`);case"code-chat-backfill-image-import":r.imports.push({type:"image",guid:t.guid,imageHash:t.imageHash});break;case"code-chat-backfill-code-import":r.imports.push({type:"node",guid:t.guid,communityAttribution:t.communityAttribution});break;case"code-chat-backfill-diff-import":r.imports.push({type:"diff",guid:t.guid,diffs:t.diffs});break;case"code-chat-backfill-inspected-element":{let{type:e,...a}=t;r.inspectedElement=a;break}case"code-chat-code-import-ref":r.imports.push(t.blobData?t.blobData:{type:"node",guid:"placeholder"});break;case"code-chat-image-import-ref":r.imports.push(t.blobData?t.blobData:{type:"image",guid:"placeholder"});break;case"code-chat-diff-import-ref":r.imports.push(t.blobData?t.blobData:{type:"diff",guid:"placeholder",diffs:""});break;case"code-chat-text-import-ref":r.imports.push(t.blobData?t.blobData:{type:"text",guid:"placeholder",path:""});break;case"code-chat-inspected-element-ref":r.inspectedElement={filePath:t.filePath,snippetStartLine:t.snippetStartLine,tagLine:t.tagLine,tagName:t.tagName,snippet:"",fileImports:"",componentHeader:""};break;case"code-chat-mcp-mention":r.mcpMentions=[...t.mcpMentions];break;case"image":case"jsx":throw new o.T(`Make does not support message part with type ${t.type}`);default:(0,l.xb)(t)}r.makeVersion=e.makeVersion;let c=d(s.K$p.USER_MESSAGE,t);return c.textContent=(0,n.J6)(r),c}case"assistant":{let a=[],r=[],i={plainText:""};for(let t of e.content)switch(t.type){case"text":throw new o.T("Cannot use 'text' for Code Chat assistant messages. Use 'code-chat-assistant-text' instead.");case"tool-call":a.push({toolCallId:t.toolCallId,toolName:t.toolName,argsJson:t.argsJSON});break;case"code-chat-legacy-assistant-tool-result":{let{type:e,...a}=t;r.push({...a});break}case"reasoning":i.signedReasoning={text:t.text,signature:t.signature??void 0};break;case"redacted-reasoning":i.redactedReasoning=t.data;break;case"code-chat-model-config-version":i.modelConfigVersion=t.modelConfigVersion;break;case"code-chat-assistant-text":i.plainText=t.text,i.mode=t.textMode;break;case"code-chat-assistant-code":case"code-chat-provider-metadata":break;case"code-chat-assistant-title":i.title=t.title;break;case"code-chat-legacy-s3-code-snapshot":{let e=i.codeSnapshot??{};i.codeSnapshot={...e,codeSnapshotKey:t.codeSnapshotKey,fileVersionId:"-1"};break}case"code-chat-code-snapshot":{let e=i.codeSnapshot??{};i.codeSnapshot={...e,blobstoreContentKey:t.blobstoreContentKey,fileVersionId:"-1"};break}default:(0,l.xb)(t)}let c=d(s.K$p.ASSISTANT_MESSAGE,t);return c.textContent=(0,n.J6)(i),c.toolCalls=a,c.toolResults=r,c}case"tool":{let a=[],o={plainText:""};for(let t of e.content)switch(t.type){case"tool-result":a.push({toolCallId:t.toolCallId,toolName:t.toolName,resultJson:t.resultJSON});break;case"tool-result-ref":a.push({toolCallId:t.toolCallId,toolName:t.toolName,resultJson:t.blobData&&null!=t.blobData.result&&"object"==typeof t.blobData.result?JSON.stringify(t.blobData.result):JSON.stringify({success:!0,unhydrated:!0,message:"Tool result not hydrated from ChatSDK Blobstore",data:"placeholder"})});break;case"code-chat-model-config-version":o.modelConfigVersion=t.modelConfigVersion;break;default:(0,l.xb)(t)}o.makeVersion=e.makeVersion;let r=d(s.K$p.TOOL_MESSAGE,t);return r.textContent=(0,n.J6)(o),r.toolResults=a,r}case"no_op":{let e=d(s.K$p.SYSTEM_MESSAGE,t);return e.textContent=JSON.stringify({type:"no_op",plainText:""}),e}case"system":throw new o.T("Chat SDK does not store system messages in the database (yet), we should never get here");default:(0,l.xb)(e)}}function d(e,t){let a=(0,n.ic)(e,t.userId??"placeholderUserId",()=>"placeholderMessageGuid");return void 0!==t.messageGuid&&(a.id=t.messageGuid),a.sentAt64=t.scenegraphSentAt??t.createdAtMs.toString(),a}async function p({aiChatMessages:e,partTypesToHydrate:t,shouldHydrateToolCallback:a,blobstoreCache:o,threadId:s,fileKey:n,logWarn:i}){let l=[];for(let[o,s]of e.entries())for(let[e,n]of s.content.entries())if((0,r.DN)(n)&&void 0===n.blobData){let s=t.includes(n.type),r="tool-result-ref"===n.type&&a(n.toolName);(s||r)&&l.push({messageIndex:o,partIndex:e,refPart:structuredClone(n)})}if(0===l.length)return{aiChatMessages:e,numHydratedRefParts:0};let c=l.map(({refPart:e})=>e.blobstoreContentKey),d=await o.fetchBlobs({fileKey:n,threadId:s,contentKeys:c});for(let{refPart:e}of l){let t,a=d.get(e.blobstoreContentKey);if(!a)continue;try{t=JSON.parse(new TextDecoder().decode(a))}catch(t){i(`Failed to parse JSON for ${e.type} part, content key ${e.blobstoreContentKey}`);continue}let o=r.hE[e.type].shape.blobData.unwrap().safeParse(t);if(!o.success){i(`Invalid JSON schema for ${e.type} part, content key ${e.blobstoreContentKey}`);continue}e.blobData=o.data}return{aiChatMessages:function(e,t){let a={};for(let[t,o]of e.entries())a[t]=[...o.content];for(let{messageIndex:e,partIndex:o,refPart:s}of t)a[e][o]=s;return e.map((e,t)=>{let o=a[t];return o?{...e,content:o}:e})}(e,l),numHydratedRefParts:l.length}}},575877(e,t,a){a.d(t,{O:()=>n});var o=a(140855),s=a(384078);let r=(e,t,a)=>{let s=t.safeParse(a);if(!s.success){let t=Object.keys(a);throw new o.T(`Failed to parse ${e} message part. Type: ${a.type}. Keys: ${t.join(", ")}. Error: ${s.error.message}`)}return s.data};function n(e){let{role:t,content:a,...n}=e;return{...(()=>{switch(t){case"user":return{role:t,content:a.map(e=>r(t,s.Fd,e))};case"assistant":return{role:t,content:a.map(e=>r(t,s.G4,e))};case"tool":return{role:t,content:a.map(e=>r(t,s.iS,e))};case"system":return{role:t,content:a.map(e=>r(t,s.jV,e))};case"no_op":return{role:t,content:a.map(e=>r(t,s.RN,e))};default:throw new o.T(`Unknown message role: ${t}`)}})(),...n}}}}]);

//# debugId=4c613be0-b6a1-56d7-9f8f-c76d17efcf1e

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/3acffa74e43501c720601f5497b6b8d90f93cc6d/938-74de6a0fb537559f.min.js.map